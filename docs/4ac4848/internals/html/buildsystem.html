<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>AgentXcpp: The Build System</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">AgentXcpp
   &#160;<span id="projectnumber">Revision:4ac4848</span>
   </div>
   <div id="projectbrief">Internals Documentation</div>
  </td>
  
  
  
   
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
   
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('buildsystem.html','');
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">The Build System </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>AgentXcpp uses <a href="http://www.scons.org">SCons</a> as an easy-to-use build system. Building agentXcpp is a one-step operation: simply invoke <code>scons</code> at the command line, and the library will be built. In addition, SCons provides operations to clean up the build directory, make parallel builds and others. Read the SCons documentation to learn more.</p>
<p>Installing the components of the agentXcpp library (header files, API documentation and the library itself) is as easy as invoking <code>scons install</code>. It is expected that agentXcpp is built by a package maintainer, not by an end user. Therefore, SCons is set up to install the library into the <code>./install-root/</code> directory by default, from where a package maintainer may pick it up for his package (e.g. a Redhat RPM package). The directories in which the files are installed are configurable for flexibility. Therefore, it is also possible to install agentXcpp right into a system.</p>
<p>This section explains how AgentXcpp is built and how SCons is used by agentXccp internally.</p>
<h2><a class="anchor" id="howtobuild"></a>
How to build AgentXcpp</h2>
<h3><a class="anchor" id="prerequisites"></a>
Prerequisites</h3>
<p>The following software is needed to build agentXcpp, simply use the versions which are easily available for your system:</p>
<ul>
<li>Standard build environment (compiler, linker, etc.)</li>
<li>Doxygen, to build the documentation</li>
<li>SCons, to control the build process</li>
<li>The boost libraries</li>
</ul>
<h3><a class="anchor" id="building"></a>
Building</h3>
<p>To build agentXcpp, simply type</p>
<p><code>scons</code></p>
<p>You may add the <code>-j</code> switch to parallelize the build (e.g. <code>-j2</code>). The doxygen documentation will also be build and can then be found in <code>doc/api/</code> and <code>doc/internals/</code>.</p>
<h3><a class="anchor" id="installing"></a>
Installing</h3>
<p>To install the library to the default location (which is <code>'install-root/'</code> in the top-level directory), type</p>
<p><code>scons install</code></p>
<p>The install directories can be specified by various command-line switches. Example:</p>
<p><code>scons --prefix=/usr/local install</code></p>
<p>This will install all files in subdirectories of <code>/usr/local/</code>. Another example:</p>
<p><code>scons --libdir=/lib --docdir=/usr/share/doc/ --includedir=/usr/include install</code></p>
<p>This installs the shared object into <code>/lib</code>, the doxygen documentation into <code>/usr/share/doc/</code> and the header files into <code>/usr/include/</code>. An added <code>--prefix</code> option would do nothing in this example, because the prefix is only used to calculate libdir, includedir and docdir. The following example will do the same as the previous one:</p>
<p><code>scons --prefix=/usr/ --libdir=/lib install</code></p>
<p>The build system will choose PREFIX/include (which is <code>/usr/include</code> in the example) as includedir and PREFIX/share/doc (which is <code>/usr/share/doc</code> in the example) as docdir. The default directories can be shown with <code>scons -h</code>.</p>
<h3><a class="anchor" id="unit_tests"></a>
Building the Unit Tests</h3>
<p>The unit tests can be build with</p>
<p><code>scons testsuite</code></p>
<h3><a class="anchor" id="cleaning"></a>
Cleaning</h3>
<p>To clean the project directory, type:</p>
<p><code>scons -c</code></p>
<p>This doesn't clean any files installed with <code>scons install</code>.</p>
<h2><a class="anchor" id="howitworks"></a>
How Scons works in agentXcpp</h2>
<p>SCons is controlled via the <code>SConstruct</code> and <code>SConscript</code> files (the "Makefiles" of SCons). These files are in fact python scripts which call certain SCons functions. These SCons functions then build agentXcpp. The root directory contains an <code>SConstruct</code> file, and each subdirectory has a <code>SConscript</code> file to control the build process inside that directory.</p>
<h3><a class="anchor" id="sconstruct"></a>
The top-level SConstruct</h3>
<p>The top-level <code>SConstruct</code> file defines the install prefix and the following directories:</p>
<ul>
<li>libdir: where the library is installed</li>
<li>includedir: where the headers are installed</li>
<li>docdir: where the API documentation is installed</li>
</ul>
<p>For each of them, a command-line option is added using the <code>AddOption()</code> function, providing a description (for the <code>-h</code> switch) and a default value. Then, the given options are read from the command line with <code>GetOption()</code> and added to the build environment. When a relative path is given, it is converted to an absolute path, because SCons functions are always invoked from the top-level directory, while the <code>scons</code> invocation may happen in a subsidiary directory. The following command-line options are provided:</p>
<ul>
<li><code>--prefix=PREFIX</code></li>
<li><code>--libdir=LIBDIR</code></li>
<li><code>--includedir=INCLUDEDIR</code></li>
<li><code>--docdir=DOCDIR</code></li>
</ul>
<p>Next, the git command <code>describe</code> is used to determine the revision from which agentXcpp is built. The revision is added to the build environment.</p>
<p>Finally, the subsidiary SConscript's are invoked, exporting the environment.</p>
<h3><a class="anchor" id="src_sconscript"></a>
src/SConscript</h3>
<p>The <code>SConscript</code> in src/ builds the library and provides the install target for it. Further, the library is defined as one of the default targets.</p>
<p>If g++ is detected, the SConscript also adds some compiler flags to get more warnings.</p>
<h3><a class="anchor" id="doc_sconscript"></a>
doc/SConscript</h3>
<p>The <code>SConscript</code> in doc/ builds the doxygen documentations (API and internals). This <code>SConscript</code> is hackish, as scons doesn't know about doxygen, and there is currently no working Doxygen builder available for it.</p>
<p>First, the SConscript defines how to build the API documentation, using the SCons <code>Command()</code> function. As target, the generated 'api/html/index.html' file is used (although many other files are generated alongside), and 'api.doxyfile', the doxygen configuration file for the API docs, is defined as primary source for the build. The command for building begins with '<code>cd doc/</code>', because the build is always started from the top-level directory, but Doxygen must be invoked in the doc directory in order to find its files. Also, this command includes shell code to feed the revision from the environment into doxygen's <code>PROJECT_NUMBER</code> variable to make it visible in the generated documentation.</p>
<p>Second, the dependencies are defined. If any dependency changes, the documentation must be rebuild. To keep things easy, all <code>*.cpp</code> and <code>*.hpp</code> files in <code>src/</code> as well as all <code>*.dox</code> files are defined to be dependencies.</p>
<p>For completeness, SCons is told how to remove the built files using the <code>Clean()</code> function to provide proper <code>scons -c</code> operation and an install target for the API documentation is defined using <code>Install()</code>.</p>
<p>These steps are then repeated for the internal documentation, except that no install target is defined for it. Finally, the API and internals documentations are defined as default targets.</p>
<p>A more appropriate implementation would scan the Doxygen configuration files for the input and output file patterns and define more accurate SCons dependencies. However, the current implementation will work until a good Doxygen builder becomes available.</p>
<h3><a class="anchor" id="unit_tests_sconscript"></a>
unit_tests/SConscript</h3>
<p>The <code>SConscript</code> in unit_tests/ builds the unit tests for agentXcpp. When using the g++ compiler, the <code>-rpath ../src/</code> parameter is added so that the unit tests can find the agentXcpp shared library although it is not installed in a well-known place (like <code>/usr/lib</code>).</p>
<p>An install target is not provided, as unit tests are of course not installed on the target system. Also, the unit tests are not defined as a default target. </p>
</div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>

    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.0 </li>
   </ul>
 </div>


</body>
</html>
